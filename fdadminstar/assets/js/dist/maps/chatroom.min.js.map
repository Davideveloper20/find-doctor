{"version":3,"sources":["chatroom.js"],"names":["chatsObj","chatsLst","loadingChats","loadingChatsLst","window","chatingWith","clearTimeout","scrr","cb","chats","$","scrollTop","i","type","messaBox","JSON","unixtime","baseName","picture","time","moment","text","position","play","lastid","idpatient","solstar","resp","data","parseInt","length","alertify","err","$iduserchat","val","loadNewChats","each","setTimeout","url","loadNewMessage","warning","message","users","fnLoadChatMessages","$data","name","$this","fillChat","evt","me","ajaxRequest","success"],"mappings":"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","file":"../chatroom.min.js","sourcesContent":["\"use strict\";\nvar chatsObj = {};\nvar chatsLst = {};\nvar loadingChats = false;\nvar loadingChatsLst = false;\nvar chatingWith = -1;\nif(window.chatInterval) {\n  clearTimeout(window.chatInterval);\n} else {\n  window.chatInterval = false;\n}\n\nfunction fillChat(chats, scrr=false, cb=null) {\n  if(chats.length <=0) {\n    $('#chat-content').animate({ scrollTop: $('#chat-content').prop(\"scrollHeight\")}, 300);\n    return false;\n  }\n  for(var i = 0; i < chats.length; i++) {\n    //console.log('existemsg', chats[i].unixtime, $('#mychatbox span[id='+chats[i].unixtime+']').length)\n    if($('#mychatbox span[id='+chats[i].unixtime+']').length <= 0) {\n      var type = chats[i].type;\n      //if(chats[i].typing != undefined) type = 'typing';\n      var messaBox = '';\n      if(type != 'text') {\n        chats[i].message = JSON.parse(chats[i].message);\n      }\n      if(type == 'text') {\n        messaBox = (chats[i].message != undefined ? chats[i].message : '')\n      } else if(type == 'audio') {\n        messaBox = '<i class=\"fas fa-volume-up\"></i> <audio preload=\"auto\" controls><source src=\"'+chats[i].message.Location+'\" type=\"'+chats[i].message.mime+'\"> </audio>';\n      } else if(type == 'video') {\n        messaBox = '<i class=\"fas fa-video\"></i> <video width=\"300\" height=\"220\" preload=\"auto\" controls><source src=\"'+chats[i].message.Location+'\" type=\"'+chats[i].message.mime+'\"> </video>';\n      } else if(type == 'image') {\n        messaBox = '<a class=\"link external\" href=\"'+chats[i].message.Location+'\" target=\"_blank\"><img class=\"img img-responsive img-fluid\" style=\"max-width:300px; height:auto;\" src=\"'+chats[i].message.Location+'\" alt=\"'+baseName(chats[i].message.File)+'\"/></a>';\n      } else if(type == 'file') {\n        messaBox = '<a class=\"link external\" href=\"'+chats[i].message.Location+'\" target=\"_blank\"><i class=\"fas fa-download fa-fw\"></i> '+baseName(chats[i].message.File)+'</a>';\n      } else {\n        messaBox = '<a class=\"link external\" href=\"'+chats[i].message.Location+'\" target=\"_blank\"><i class=\"fas fa-download fa-fw\"></i> '+baseName(chats[i].message.File)+'</a>';\n      }\n      $.chatCtrl('#mychatbox', {\n        text: messaBox,\n        picture: chats[i].profimg_from,\n        position: 'chat-'+(chats[i].owner == \"0\" ? 'left' : 'right'),\n        time: '<span id=\"'+chats[i].unixtime+'\">'+moment(chats[i].create_at).format('DD/MM/YYYY hh:mm a')+'</span>',\n        type: 'text',\n      });\n    }\n    if(scrr) {\n      $('#chat-content').animate({ scrollTop: $('#chat-content').prop(\"scrollHeight\")}, 0);\n    }\n  }\n  if((typeof cb) == 'function') {\n    return cb();\n  }\n  return true;\n}\n\nfunction loadNewMessage(idpatient, play=false) {\n\n  var lastid = $(`.loadChatMessages[data-iduserchat=${idpatient}]`).data('lastid');\n  var url = `Doctor/Get-Chat-Messages/${idpatient}/1/${lastid}`;\n  solstar.ajaxRequest(url, 'POST', function(resp) {\n      if(resp.success) {\n        if(resp.data.length > 0) {\n          if((typeof chatsObj[idpatient]) == 'undefined') {\n            chatsObj[idpatient] = [];\n          }\n          if(play) {\n\t        \t//$('#startAudio')[0].play();\n\t        \t//setTimeout(() => {$('#startAudio')[0].pause();}, 500);\n\t        }\n          $(`.loadChatMessages[data-iduserchat=${idpatient}]`).data({\n            'lastid' : parseInt(resp.data[resp.data.length-1].id) || 0,\n          });\n          //chatsObj[idpatient] = \n          $.extend(true, chatsObj[idpatient], resp.data);\n          if(chatingWith > 0) {\n            fillChat(resp.data, true, function() {\n              $('#chat-content').animate({ scrollTop: $('#chat-content').prop(\"scrollHeight\")}, 10);\n            });\n          }\n        } else {\n          $('#chat-content').animate({ scrollTop: $('#chat-content').prop(\"scrollHeight\")}, 10);\n        }\n      } else {\n        alertify.warning('Ha ocurrido un error! '+resp.message, 10);\n      }\n    }, {\n    }, true, null, function(err) {\n      alertify.warning('Ha ocurrido un error! '+(err.message || ''), 10);\n    }\n  );\n}\n\nfunction loadNewChats() {\n  $('div.loadChatMessages').each(function(idx, val) {\n\t\tvar $iduserchat = $(val).data('iduserchat');\n\t\tif((typeof chatsLst[$iduserchat]) == 'undefined') {\n\t\t\tchatsLst[$iduserchat] = 0;\n\t\t}\n  })\n  if(!loadingChats) {\n    loadingChats = true;\n    var url = `Doctor/DocPatientChat`;\n    solstar.ajaxRequest(url, 'POST', function(resp) {\n        if(resp.success) {\n          loadingChats = false;\n          //console.log('Doctor/DocPatientChat', resp.data);\n          $.each(resp.data, function(index, val) {\n            if($('#chatUsersBox li[data-iduserchat='+val.idusers+']').length == 0) {\n              $('#chatUsersBox').append('<li class=\"media\" data-iduserchat=\"'+val.idusers+'\"><img alt=\"image\" class=\"mr-3 rounded-circle loadChatMessages\" data-name=\"'+val.fullname+'\" width=\"50\" data-lastid=\"0\" data-firstid=\"0\" data-iduserchat=\"'+val.idusers+'\" src=\"'+val.profileimage+'\"><div class=\"media-body\"><div class=\"mt-0 mb-1 font-weight-bold loadChatMessages\" data-name=\"'+val.fullname+'\" data-iduserchat=\"'+val.idusers+'\" data-lastid=\"0\" data-firstid=\"0\">'+val.fullname+'</div></div><span class=\"badge badge-primary\">Nuevo</span></li>');\n              alertify.message('Nuevo Chat de <b>'+val.fullname+'</b>', 15);\n              //$('#dingAudio')[0].play();\n              $('#notifmessage').addClass('beep');\n              setTimeout(() => {$('#dingAudio')[0].pause();}, 500);\n              $('.loadChatMessages').off('click').on('click', fnLoadChatMessages);\n              $('#chatUsersBox, #chatUsersBoxCnt').css('overflow', 'auto !important');\n            }\n          });\n        } else {\n          loadingChats = false;\n          alertify.warning('Ha ocurrido un error! '+resp.message, 10);\n        }\n      }, {\n      }, true, null, function(err) {\n        loadingChats = false;\n        alertify.warning('Ha ocurrido un error! '+(err.message || ''), 10);\n      }\n    );\n  }\n\n  if(!loadingChatsLst) {\n    loadingChatsLst = true;\n    var url = `Doctor/DocPatientChatLst`;\n    solstar.ajaxRequest(url, 'POST', function(resp) {\n        if(resp.success) {\n          loadingChatsLst = false;\n          $.each(resp.data, function(index, val) {\n  \t\t\t\t\tif(chatsLst[index] < val) {\n  \t\t\t\t\t\tloadNewMessage(index, false);\n  \t\t\t\t\t}\n  \t\t\t\t\t//      \t \n          });\n        } else {\n          loadingChatsLst = false;\n          alertify.warning('Ha ocurrido un error! '+resp.message, 10);\n        }\n      }, {\n      \tusers: chatsLst\n      }, true, null, function(err) {\n        loadingChatsLst = false;\n        alertify.warning('Ha ocurrido un error! '+(err.message || ''), 10);\n      }\n    );\n  }\n}\n\nwindow.chatNInterval = setInterval(function() {\n  loadNewChats();\n}, 1800);\n\nvar fnLoadChatMessages = function(evt) {\n  var $this = this;\n  var $data = $(this).data();\n  //console.log('.loadChatMessages', $this, $data)\n  if(window.chatInterval) {\n    clearTimeout(window.chatInterval);\n  }\n  $('#chatTitleBox').html(`Chat: <b>${$data.name}</b>`);\n  $('#chat-content').html('');\n  $('#btnSend').data('iduser', $data.iduserchat);\n  if($('#chatUsersBox li[data-iduserchat=\"'+$data.iduserchat+'\"] span.badge').length > 0) {\n    $('#chatUsersBox li[data-iduserchat=\"'+$data.iduserchat+'\"] span.badge').fadeOut();\n  }\n  if($('#btnSend').hasClass('btn-danger')) {\n    $('#btnSend').removeClass('btn-danger').addClass('btn-primary');\n  }\n  chatingWith = $data.iduserchat;\n  $('#btnSend').attr('disabled', false).prop('disabled', false);\n  if((typeof chatsObj[$data.iduserchat]) != 'undefined' && chatsObj[$data.iduserchat].length > 0) {\n    fillChat(chatsObj[$data.iduserchat], false, function() {\n\t\t\t//$('#chat-content').animate({ scrollTop: $('#chat-content').prop(\"scrollHeight\")}, 300);    \t\n    });\n  }\n  /*var url = `Doctor/Get-Chat-Messages/${$data.iduserchat}/1/${$data.lastid}`;\n  solstar.ajaxRequest(url, 'POST', function(resp) {\n      if(resp.success) {\n        if((typeof chatsObj[$data.iduserchat]) == 'undefined') {\n          chatsObj[$data.iduserchat] = [];\n        }\n        if(resp.data.length > 0) {\n          $(`.loadChatMessages[data-iduserchat=${$data.iduserchat}]`).data({\n            'firstid' : parseInt(resp.data[0].id) || 0,\n            'lastid' : parseInt(resp.data[resp.data.length-1].id) || 0,\n          });\n          //chatsObj[$data.iduserchat] = \n          fillChat(resp.data, function() {\n            $('#chat-content').animate({ scrollTop: $('#chat-content').prop(\"scrollHeight\")}, 10);\n          });\n          $('#chat-content').animate({ scrollTop: $('#chat-content').prop(\"scrollHeight\")}, 0);\n          $.extend(true, chatsObj[$data.iduserchat], resp.data);\n        }\n        window.chatInterval = setInterval(function() {loadNewMessage($data.iduserchat)}, 1500);\n      } else {\n        alertify.warning('Ha ocurrido un error! '+resp.message, 10);\n      }\n    }, {\n    }, true, null, function(err) {\n      alertify.warning('Ha ocurrido un error! '+(err.message || ''), 10);\n    }\n  );*/\n};\n$('.loadChatMessages').off('click').on('click', fnLoadChatMessages);\n\n$('#messageBox-txt').on('keypress', function(evt) {\n  if(evt.keyCode == 13 || evt.charCode == 13) {\n    $(\"#btnSend\").trigger('click');\n  }\n});\n$(\"#btnSend\").off('click').on('click', function(evt) {\n  var me = $(\"#chat-form\");\n  var $this = $(this);\n  if(me.find('input').val().trim().length > 0) {      \n    var url = `Doctor/Send-Chat-Messages/${$this.data('iduser')}`;\n    solstar.ajaxRequest(url, 'POST', function(resp) {\n        if(resp.success) {\n          var msgObj = resp.data[0];\n          //$(`.loadChatMessages[data-iduserchat=${$this.data('iduser')}]`).data({\n          //  'lastid' : parseInt(msgObj.id) || 0,\n          //});\n          /*$.chatCtrl('#mychatbox', {\n            text: msgObj.message,\n            picture: msgObj.profimg_from,\n            type: msgObj.type,\n            time: moment(msgObj.create_at).format('DD/MM/YYYY hh:mm a'),\n            onShow: function(th, el) {\n              $('#chat-content').animate({ scrollTop: $('#chat-content').prop(\"scrollHeight\")}, 300);\n            }\n          });*/\n          $('#chat-content').animate({ scrollTop: $('#chat-content').prop(\"scrollHeight\")}, 20);\n          me.find('input').val('');\n        } else {\n          alertify.warning('Ha ocurrido un error! '+resp.message, 10);\n        }\n      }, {\n        message: me.find('input').val(),\n        unixtime: moment().locale('es').unix(),\n      }, true, null, function(err) {\n        alertify.warning('Ha ocurrido un error! '+(err.message || ''), 10);\n      }\n    );\n  } \n  return false;\n});\n"]}
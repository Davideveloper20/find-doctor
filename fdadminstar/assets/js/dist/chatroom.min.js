"use strict";var chatsObj={},chatsLst={},loadingChats=!1,loadingChatsLst=!1,chatingWith=-1;window.chatInterval?clearTimeout(window.chatInterval):window.chatInterval=!1;function fillChat(a,b=!1,c=null){if(0>=a.length)return $("#chat-content").animate({scrollTop:$("#chat-content").prop("scrollHeight")},300),!1;for(var d=0;d<a.length;d++){if(0>=$("#mychatbox span[id="+a[d].unixtime+"]").length){var e=a[d].type,f="";"text"!=e&&(a[d].message=JSON.parse(a[d].message)),f="text"==e?null==a[d].message?"":a[d].message:"audio"==e?"<i class=\"fas fa-volume-up\"></i> <audio preload=\"auto\" controls><source src=\""+a[d].message.Location+"\" type=\""+a[d].message.mime+"\"> </audio>":"video"==e?"<i class=\"fas fa-video\"></i> <video width=\"300\" height=\"220\" preload=\"auto\" controls><source src=\""+a[d].message.Location+"\" type=\""+a[d].message.mime+"\"> </video>":"image"==e?"<a class=\"link external\" href=\""+a[d].message.Location+"\" target=\"_blank\"><img class=\"img img-responsive img-fluid\" style=\"max-width:300px; height:auto;\" src=\""+a[d].message.Location+"\" alt=\""+baseName(a[d].message.File)+"\"/></a>":"file"==e?"<a class=\"link external\" href=\""+a[d].message.Location+"\" target=\"_blank\"><i class=\"fas fa-download fa-fw\"></i> "+baseName(a[d].message.File)+"</a>":"<a class=\"link external\" href=\""+a[d].message.Location+"\" target=\"_blank\"><i class=\"fas fa-download fa-fw\"></i> "+baseName(a[d].message.File)+"</a>",$.chatCtrl("#mychatbox",{text:f,picture:a[d].profimg_from,position:"chat-"+("0"==a[d].owner?"left":"right"),time:"<span id=\""+a[d].unixtime+"\">"+moment(a[d].create_at).format("DD/MM/YYYY hh:mm a")+"</span>",type:"text"})}b&&$("#chat-content").animate({scrollTop:$("#chat-content").prop("scrollHeight")},0)}return"function"!=typeof c||c()}function loadNewMessage(a,b=!1){var c=$(`.loadChatMessages[data-iduserchat=${a}]`).data("lastid");solstar.ajaxRequest(`Doctor/Get-Chat-Messages/${a}/1/${c}`,"POST",function(c){c.success?0<c.data.length?("undefined"==typeof chatsObj[a]&&(chatsObj[a]=[]),b,$(`.loadChatMessages[data-iduserchat=${a}]`).data({lastid:parseInt(c.data[c.data.length-1].id)||0}),$.extend(!0,chatsObj[a],c.data),0<chatingWith&&fillChat(c.data,!0,function(){$("#chat-content").animate({scrollTop:$("#chat-content").prop("scrollHeight")},10)})):$("#chat-content").animate({scrollTop:$("#chat-content").prop("scrollHeight")},10):alertify.warning("Ha ocurrido un error! "+c.message,10)},{},!0,null,function(a){alertify.warning("Ha ocurrido un error! "+(a.message||""),10)})}function loadNewChats(){if($("div.loadChatMessages").each(function(a,b){var c=$(b).data("iduserchat");"undefined"==typeof chatsLst[c]&&(chatsLst[c]=0)}),!loadingChats){loadingChats=!0;var a=`Doctor/DocPatientChat`;solstar.ajaxRequest(a,"POST",function(a){a.success?(loadingChats=!1,$.each(a.data,function(a,b){0==$("#chatUsersBox li[data-iduserchat="+b.idusers+"]").length&&($("#chatUsersBox").append("<li class=\"media\" data-iduserchat=\""+b.idusers+"\"><img alt=\"image\" class=\"mr-3 rounded-circle loadChatMessages\" data-name=\""+b.fullname+"\" width=\"50\" data-lastid=\"0\" data-firstid=\"0\" data-iduserchat=\""+b.idusers+"\" src=\""+b.profileimage+"\"><div class=\"media-body\"><div class=\"mt-0 mb-1 font-weight-bold loadChatMessages\" data-name=\""+b.fullname+"\" data-iduserchat=\""+b.idusers+"\" data-lastid=\"0\" data-firstid=\"0\">"+b.fullname+"</div></div><span class=\"badge badge-primary\">Nuevo</span></li>"),alertify.message("Nuevo Chat de <b>"+b.fullname+"</b>",15),$("#notifmessage").addClass("beep"),setTimeout(()=>{$("#dingAudio")[0].pause()},500),$(".loadChatMessages").off("click").on("click",fnLoadChatMessages),$("#chatUsersBox, #chatUsersBoxCnt").css("overflow","auto !important"))})):(loadingChats=!1,alertify.warning("Ha ocurrido un error! "+a.message,10))},{},!0,null,function(a){loadingChats=!1,alertify.warning("Ha ocurrido un error! "+(a.message||""),10)})}if(!loadingChatsLst){loadingChatsLst=!0;var a=`Doctor/DocPatientChatLst`;solstar.ajaxRequest(a,"POST",function(a){a.success?(loadingChatsLst=!1,$.each(a.data,function(a,b){chatsLst[a]<b&&loadNewMessage(a,!1)})):(loadingChatsLst=!1,alertify.warning("Ha ocurrido un error! "+a.message,10))},{users:chatsLst},!0,null,function(a){loadingChatsLst=!1,alertify.warning("Ha ocurrido un error! "+(a.message||""),10)})}}window.chatNInterval=setInterval(function(){loadNewChats()},1800);var fnLoadChatMessages=function(){var a=this,b=$(this).data();window.chatInterval&&clearTimeout(window.chatInterval),$("#chatTitleBox").html(`Chat: <b>${b.name}</b>`),$("#chat-content").html(""),$("#btnSend").data("iduser",b.iduserchat),0<$("#chatUsersBox li[data-iduserchat=\""+b.iduserchat+"\"] span.badge").length&&$("#chatUsersBox li[data-iduserchat=\""+b.iduserchat+"\"] span.badge").fadeOut(),$("#btnSend").hasClass("btn-danger")&&$("#btnSend").removeClass("btn-danger").addClass("btn-primary"),chatingWith=b.iduserchat,$("#btnSend").attr("disabled",!1).prop("disabled",!1),"undefined"!=typeof chatsObj[b.iduserchat]&&0<chatsObj[b.iduserchat].length&&fillChat(chatsObj[b.iduserchat],!1,function(){})};$(".loadChatMessages").off("click").on("click",fnLoadChatMessages),$("#messageBox-txt").on("keypress",function(a){(13==a.keyCode||13==a.charCode)&&$("#btnSend").trigger("click")}),$("#btnSend").off("click").on("click",function(){var a=$("#chat-form"),b=$(this);if(0<a.find("input").val().trim().length){var c=`Doctor/Send-Chat-Messages/${b.data("iduser")}`;solstar.ajaxRequest(c,"POST",function(b){if(b.success){b.data[0];$("#chat-content").animate({scrollTop:$("#chat-content").prop("scrollHeight")},20),a.find("input").val("")}else alertify.warning("Ha ocurrido un error! "+b.message,10)},{message:a.find("input").val(),unixtime:moment().locale("es").unix()},!0,null,function(a){alertify.warning("Ha ocurrido un error! "+(a.message||""),10)})}return!1});
//# sourceMappingURL=maps/chatroom.min.js.map
